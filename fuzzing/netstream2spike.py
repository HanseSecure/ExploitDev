#!/usr/bin/python
'''
Content:	exploitDev fuzzing Helper: Takes a textfile containing a networkStream (for
		example from wireshark) and convert it into a fuzzing template for spike "fuzz.txt"
Author: 	Florian Hansemann | @HanseSecure | https://hansesecure.de
Date: 		02/2018

Usage:		python netStream2spike.py stream.txt

'''

import optparse

def start(fuzz_input):
    i = 1
    file = open('fuzz.spk', 'w')
    with open(fuzz_input) as f:
        for line in f:
            stage_1 = line.replace(' ', ' \ns_string("')
            stage_2 = ''.join(('s_string("', stage_1, ''))
            file.write("//New requestLine: "+str(i)+"\n" + stage_2.replace('\n', '");\n'))
            file.write('s_string("\\r\\n");\n')
            file.write('s_readline();\n')
            i = i + 1


#	Main Methode
def main():
    parser = optparse.OptionParser('-f <commands.txt>')
    parser.add_option('-f', dest='fuzz_input', type='string', help='specify fuzz.spike')
    (options, args) = parser.parse_args()
    fuzz_input = options.fuzz_input
    if fuzz_input == None:
        print parser.usage
        exit(0)
    start(fuzz_input)


if __name__ == '__main__':
    main()
